<!DOCTYPE html>
<html>
<head>
	<meta charset="ISO-8859-1">
	<title>Test Planner</title>
	<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css">
	<style>
	.page::before{ counter-increment: page; content: "Pagina "counter(page)")"; font-weight: bold;}
	.attr{display: table-row;}
	.attr > * {display: table-cell;}
	
	.attr label {vertical-align: top; padding-right: .5em;}
	body{counter-reset: page;}
	.test {border-bottom: 3px double black;margin-bottom: .5em;}
	.test > div {display: inline-block;}
	</style>
</head>
<body>
	<h1>Test Planner</h1>
	<div id="pages">
		<label for="suite">Nome Suite:</label> <input type="text" id="suite">
		<hr>
	</div>
	<button class="jAddpage pure-button pure-button-primary">Adicionar P&aacute;gina</button>
	<button class="jExportJSON pure-button">Exportar JSON</button>

	<script src="bower_components/requirejs/require.js"></script>
	<script src="gen/jquery-2.1.4.min.js"></script>
	<script>
		require(['config'], function (config) {
			var $pages = $('#pages');
			$('.jAddpage').click(function(event) {
				require(['stache!page'], function (page) {
					$pages.append(page({id: $pages.find('.page').length}));
				});
			});
			$pages.on('click', '.jAddpage', function() {
				var $this = $(this);
				require(['stache!page'], function (page) {
					$this.closest('.page').before(page({id: $pages.find('.page').length}));
				});
			});
			$pages.on('click', '.jAddtest', function() {
				var $this = $(this);
				var $tests = $this.closest('.page').find('.tests');
				require(['stache!test'], function (test) {
					$tests.append(test({id: $tests.find('.test').length}));
				});
			});
			$('.jExportJSON').click(function() {
				var suite = {
					suite: $('#suite').val(),
					pages:$('.page').map(function(ind, page) {
						var $page = $(this);
						return {
							target: $page.find('.target').val(),
							comment: $page.find('.comment').val(),
							tests: $page.find('.test').map(function(ind, test) {
								var $test = $(this);
								var conditions = $test.find('.conditions').val() || '';
								var procedures = $test.find('.procedures').val() || '';
								var expected = $test.find('.expected').val() || '';
								return {
									conditions: conditions.split('\n\n'),
									procedures: procedures.split('\n\n'),
									expected: expected
								};
							}).get(),
						};
					}).get(),
				};
				console.log(suite);
			});
		});
	</script>
</body>
</html>